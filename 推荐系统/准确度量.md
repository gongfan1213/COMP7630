
这页PPT主要介绍了评估推荐系统排序准确性（Ranking Accuracy）的两种方法：斯皮尔曼等级相关系数（Spearman’s Rank Correlation）和肯德尔等级相关系数（Kendall’s Tau, $\tau$ ）。

### 斯皮尔曼等级相关系数（Spearman’s Rank Correlation）
- **定义**：用于衡量两个排序$x$和$y$之间的相关性，本质上是两个排序变量的皮尔逊相关系数 。
- **公式**：$\rho = 1 - \frac{6\sum_{i = 1}^{n}(x_i - y_i)^2}{n^3 - n}$ 。其中，$n$是排序中元素的数量，$x_i$和$y_i$分别是第$i$个元素在两个排序$x$和$y$中的排名 。该公式通过计算每个元素在两个排序中排名差值的平方和，来衡量两个排序的差异程度，进而得到相关性系数。系数$\rho$的取值范围在 - 1到1之间，1表示两个排序完全正相关（顺序完全相同）， - 1表示完全负相关（顺序完全相反），0表示无相关性。

### 肯德尔等级相关系数（Kendall’s Tau, $\tau$ ）
- **原理**：通过比较推荐排序（recommended ranking）和真实排序（ground truth ranking）中物品对的顺序一致性来评估排序准确性 。
- **一致对与不一致对**
    - **一致对（Concordant）**：在推荐排序和真实排序中，物品对的顺序保持不变，即若在推荐排序中物品$A$排在物品$B$前面，在真实排序中物品$A$也排在物品$B$前面 ，则称$(A,B)$为一致对。
    - **不一致对（Disconcordant）**：在推荐排序和真实排序中，物品对的顺序发生变化，即若在推荐排序中物品$A$排在物品$B$前面，但在真实排序中物品$B$排在物品$A$前面 ，则称$(A,B)$为不一致对。
- **公式**：$\tau = \frac{c - d}{{n\choose2}}=\frac{c - d}{n(n - 1)/2}$ 。其中，$c$是一致对的数量，$d$是不一致对的数量，$n$是物品的总数 。${n\choose2}=\frac{n(n - 1)}{2}$表示从$n$个物品中选取2个物品组成物品对的总组合数。$\tau$的取值范围也在 - 1到1之间，含义与斯皮尔曼等级相关系数类似，用于反映两个排序的一致程度。 

判断`concordant`（一致对 ）和`discordant`（不一致对 ）是基于推荐排序（Predicted Rank）和真实排序（True Rank）中物品对的顺序关系，具体规则如下：
- **concordant（一致对）**：在推荐排序和真实排序中，两个物品的相对顺序保持一致 。例如对于物品对$(i_a, i_b)$ ，在推荐排序中$i_a$排在$i_b$前面，在真实排序中$i_a$也排在$i_b$前面，那么$(i_a, i_b)$就是`concordant` 。
- **discordant（不一致对）**：在推荐排序和真实排序中，两个物品的相对顺序发生了变化 。即若在推荐排序中$i_a$排在$i_b$前面，但在真实排序中$i_b$排在$i_a$前面，那么$(i_a, i_b)$就是`discordant` 。

结合图中例子来分析：
- 对于物品对$(i_1, i_2)$ ：在推荐排序中$i_1$的排名（第1位）在$i_2$（第2位）前面，在真实排序中$i_1$（第1位）也在$i_2$（第4位）前面，所以$(i_1, i_2)$是`concordant` 。 
- 对于物品对$(i_2, i_3)$ ：在推荐排序中$i_2$（第2位）在$i_3$（第3位）前面，而在真实排序中$i_3$（第2位）在$i_2$（第4位）前面，相对顺序改变了，所以$(i_2, i_3)$是`discordant` 。 以此类推，就可以得出图中所有物品对的`concordant`或`discordant`状态。 


### 准确性度量（Accuracy Metrics）
1. **总体目标与度量类型**
    - **目标**：确定哪种推荐系统（RS）方法更适合当前的推荐问题。
    - **度量类型**
        - **评分值准确性（Rating Value Accuracy）**：衡量推荐系统预测评分与真实评分的接近程度。
        - **分类准确性（Classification Accuracy）**：评估对物品好坏判断正确与否的比例。 
        - **排序准确性（Ranking Accuracy）**：判断推荐系统预测的排序与真实排序的接近程度。
    - **数据要求**：需要推荐系统的预测结果，同时要有真实数据用于对比，真实数据可通过问卷调查、调研、眼动追踪等方式获取。
2. **评分值准确性**
    - **平均绝对误差（Mean Absolute Error, MAE）**：预测评分（$p$）与用户真实评分（$r$）之间平均绝对偏差 。公式为$MAE=\frac{\sum_{ij}|\hat{r}_{ij}-r_{ij}|}{n}$ ，其中$\hat{r}_{ij}$是预测评分，$r_{ij}$是真实评分，$n$是评分数量。归一化平均绝对误差$NMAE = MAE/(r_{max}-r_{min})$ ，用于在不同评分范围下比较。
    - **均方根误差（Root Mean Square Error, RMSE）**：与MAE类似，但更强调较大的偏差。公式为$RMSE=\sqrt{\frac{1}{n}\sum_{ij}(\hat{r}_{ij}-r_{ij})^2}$ 。
    - **示例**：通过具体的预测评分和真实评分数据，计算出MAE = 2 ，NMAE = 0.5 ，RMSE = 2.28 。
3. **分类准确性**
    - **混淆矩阵（Confusion Matrix）**：用于总结分类结果，行表示真实类别（相关、不相关），列表示预测类别（选中、未选中），元素$N_{rs}$表示真实相关且被选中的数量等 。
    - **精确率（Precision）**：衡量精确程度，即所有被检索出的物品中相关物品的比例，公式为$P = \frac{N_{rs}}{N_s}$ 。
    - **召回率（Recall）**：衡量完整程度，即所有相关物品中被检索出的比例，公式为$R = \frac{N_{rs}}{N_r}$ 。
    - **F - 度量（F - measure）**：精确率和召回率从不同方面评估，通过调和平均数综合两者。公式为$F=\frac{2PR}{P + R}$ 。
    - **示例**：根据给定的混淆矩阵数据，计算出$P = 0.75$ ，$R = 0.375$ ，$F = 0.5$ 。
4. **排序准确性**
    - **斯皮尔曼等级相关系数（Spearman’s Rank Correlation）**：计算两个排序$x$和$y$之间的皮尔逊相关系数，公式为$\rho = 1-\frac{6\sum_{i = 1}^{n}(x_i - y_i)^2}{n^3 - n}$ ，反映预测排序和真实排序的相关性。
    - **肯德尔等级相关系数（Kendall’s Tau, $\tau$）**
        - **原理**：比较推荐排序和真实排序，一致对（concordant）指在推荐排序中顺序保持不变的物品对，否则为不一致对（discordant） 。
        - **公式**：$\tau=\frac{c - d}{{n\choose2}}=\frac{c - d}{n(n - 1)/2}$ ，其中$c$是一致对数量，$d$是不一致对数量 。
    - **示例**：对于给定的四个物品的预测排序和真实排序，确定物品对的一致/不一致状态，计算出$\tau = 0.33$ 。
    - **肯德尔tau中的平局（Ties in Kendall's - tau）**：若$(x_i,x_j)$和$(y_i,y_j)$中$x_i = x_j$或$y_i = y_j$ ，则称这对为平局。平局对既不是一致对也不是不一致对，有平局时肯德尔tau公式不变。 



